<!DOCTYPE html>
<html lang="en">
<head>
  <title>OpTiMSoC User Guide</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- external CSS -->
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

  <!-- our own CSS (must be include after bootstrap.css!) -->
  <link rel="stylesheet" href="/css/optimsoc.css"/>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="/js/html5shiv.js"></script>
    <script src="/js/respond.min.js"></script>
  <![endif]-->

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Google Web Fonts -->
  <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,400italic,600,700,900" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600,700" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Fredericka+the+Great" rel="stylesheet" type="text/css">
</head>
<body  data-offset='50' data-spy="scroll" data-target="">
  <!-- top navigation bar -->
  <nav class="navbar navbar-fixed-top optimsoc-nav" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/index.html" alt="OpTiMSoC"><span class="wordmark">OpTiMSoC</span></a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/download.html">Download</a></li>
          <li><a href="/docs/index.html">Documentation</a></li>
          <li><a href="/getinvolved.html">Get involved</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/blog">Blog</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container" id="maincontent">
  
  <div class="optimsoc-section-header">
    <h1>User Guide</h1>
  </div>
  <hr/>
  

      <div class="col-md-3"><div class="optimsoc-doc-mainnav" data-spy="affix" data-offset-top="50">
<div style="padding-bottom:10px">
          version 2016.1

          (<a href="/docs/index.html#document-archive">other versions</a>)
        </div>
<ul class="nav">
<li><a href="chap_introduction.html" title="Chapter&nbsp;1 Introduction &#8227; OpTiMSoC User Guide">Introduction</a></li>
<li><a href="chap_installation.html" title="Chapter&nbsp;2 Installation &amp; Configuration &#8227; OpTiMSoC User Guide">Installation &amp; Configuration</a></li>
<li class="active">
<div class="active">Tutorials</div>
<div id="optimsoc-doc-subnav-nav" class="optimsoc-doc-subnav hidden-print" role="complementary"><ul class="nav">
<li class=""><a href="#S1" title="3.1 Starting Small: Compute Tile and Embedded Software (Simulated) &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide">Starting Small: Compute Tile and Embedded Software (Simulated)</a></li>
<li class=""><a href="#S2" title="3.2 See the Waves &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide">See the Waves</a></li>
<li class=""><a href="#S3" title="3.3 Going Multicore: Simulate a Multicore Compute Tile &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide">Going Multicore: Simulate a Multicore Compute Tile</a></li>
<li class=""><a href="#S4" title="3.4 Tiled Multicore SoC: Simulate a Small 2x2 Distributed Memory
System &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide">Tiled Multicore SoC: Simulate a Small 2x2 Distributed Memory
System</a></li>
<li class=""><a href="#S5" title="3.5 Observing Software During Execution: The Debug System &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide">Observing Software During Execution: The Debug System</a></li>
<li class=""><a href="#S6" title="3.6 Automating System Interaction &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide">Automating System Interaction</a></li>
<li class=""><a href="#S7" title="3.7 Our SoC on an FPGA &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide">Our SoC on an FPGA</a></li>
</ul></div>
</li>
<li><a href="chap_develop-optimsoc.html" title="Chapter&nbsp;4 Develop OpTiMSoC &#8227; OpTiMSoC User Guide">Develop OpTiMSoC</a></li>
</ul>
</div></div><div class="col-md-9 optimsoc-doc-body">
<div class="ltx_page_main">
<div class="ltx_page_content">
<section class="ltx_chapter">
<h1 class="ltx_title ltx_title_chapter">
<span class="ltx_tag ltx_tag_chapter">Chapter&nbsp;3 </span>Tutorials</h1>
<div class="ltx_date ltx_role_creation"></div>

<div id="p1" class="ltx_para">
<p class="ltx_p">The best way to get started with OpTiMSoC after you&rsquo;ve prepared your
system as described in the previous chapter is to follow some of our
tutorials. They are written with two goals in mind: to introduce some
of the basic concepts and nomenclature of manycore SoC, and to show
you how those are implemented and can be used in OpTiMSoC.</p>
</div>
<div id="p2" class="ltx_para">
<p class="ltx_p">Some of the tutorials (especially the first ones) build on top of each
other, so it&rsquo;s recommended to do them in order. Simply stop if you
think you know enough to implement your own ideas!</p>
</div>
<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3.1 </span>Starting Small: Compute Tile and Embedded Software (Simulated)</h2>

<div id="S1.p1" class="ltx_para">
<p class="ltx_p">It is a good starting point to simulate a single compute tile of a
distributed memory system. Therefore a simple example is included and
demonstrates the general simulation approach and gives an insight in
the software building process.</p>
</div>
<div id="S1.p2" class="ltx_para">
<p class="ltx_p">Simulating only a single compute tile is essentially an OpenRISC core
plus memory and the network adapter, where all I/O of the network
adapter is not functional in this test case. It can therefore only be
used to simulate local software.</p>
</div>
<div id="S1.p3" class="ltx_para">
<p class="ltx_p">You can find this example in <span class="ltx_ref ltx_path ltx_ref_self"><span class="ltx_text ltx_font_typewriter">$OPTIMSOC/examples/sim/compute_tile</span></span>.</p>
</div>
<div id="S1.p4" class="ltx_para">
<p class="ltx_p">In addition to the SoC &ldquo;hardware&rdquo; (which, in this case, is simulated of course), you also need software that runs on the system.
Our demonstration software is available in an extra repository:</p>
</div>
<div id="S1.p5" class="ltx_para">
<div id="LSTx11" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,git%20clone%20https://github.com/optimsoc/baremetal-apps%0Acd%20baremetal-apps">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">git<span class="ltx_text ltx_lst_space">&nbsp;</span>clone<span class="ltx_text ltx_lst_space">&nbsp;</span>https://github.com/optimsoc/baremetal-apps</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">cd<span class="ltx_text ltx_lst_space">&nbsp;</span>baremetal-apps</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S1.p6" class="ltx_para">
<p class="ltx_p">Build a simple &ldquo;Hello World&rdquo; example:</p>
</div>
<div id="S1.p7" class="ltx_para">
<div id="LSTx12" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,cd%20hello%0Amake">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">cd<span class="ltx_text ltx_lst_space">&nbsp;</span>hello</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">make</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S1.p8" class="ltx_para">
<p class="ltx_p">You will then find the executable elf file as <span class="ltx_ref ltx_path ltx_ref_self"><span class="ltx_text ltx_font_typewriter">hello/hello.elf</span></span>.
Furthermore some other files are built.
They are essentially transformed versions of the ELF file, i.e. the software binary.</p>
</div>
<div id="S1.p9" class="ltx_para">
<ul id="I1" class="ltx_itemize">
<li id="I1.i1" class="ltx_item">
<div id="I1.i1.p1" class="ltx_para">
<p class="ltx_p"><code class="ltx_verbatim ltx_font_typewriter">hello.dis</code> is the disassembly of the file
</p>
</div>
</li>
<li id="I1.i2" class="ltx_item">
<div id="I1.i2.p1" class="ltx_para">
<p class="ltx_p"><code class="ltx_verbatim ltx_font_typewriter">hello.bin</code> is the elf representation of the binary file</p>
</div>
</li>
<li id="I1.i3" class="ltx_item">
<div id="I1.i3.p1" class="ltx_para">
<p class="ltx_p"><code class="ltx_verbatim ltx_font_typewriter">hello.vmem</code> is a textual copy of the binary file</p>
</div>
</li>
</ul>
</div>
<div id="S1.p10" class="ltx_para">
<p class="ltx_p">Now you have everything you need to run the hello world example on a simulated SoC hardware:</p>
</div>
<div id="S1.p11" class="ltx_para">
<div id="LSTx13" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,%24OPTIMSOC/examples/sim/compute_tile/compute_tile_sim_singlecore%20--meminit=hello.vmem">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">$OPTIMSOC/examples/sim/compute_tile/compute_tile_sim_singlecore<span class="ltx_text ltx_lst_space">&nbsp;</span>--meminit=hello.vmem</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S1.p12" class="ltx_para">
<p class="ltx_p">And you&rsquo;ll get roughly this output:</p>
</div>
<div id="S1.p13" class="ltx_para">
<div id="LSTx14" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,TOP.tb_compute_tile.u_compute_tile.gen_cores%5B0%5D.u_core.u_cpu.bus_gen.ibus_bridge:%20Wishbone%20bus%20IF%20is%20B3_REGISTERED_FEEDBACK%0ATOP.tb_compute_tile.u_compute_tile.gen_cores%5B0%5D.u_core.u_cpu.bus_gen.dbus_bridge:%20Wishbone%20bus%20IF%20is%20B3_REGISTERED_FEEDBACK%0A%5B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2022,%200%5D%20Software%20reset%0A%5B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2063128,%200%5D%20Terminated%20at%20address%200x0000e958%20(status:%20%20%20%20%20%20%20%20%20%200)%0A-%20../src/optimsoc_trace_monitor_trace_monitor/verilog/trace_monitor.sv:89:%20Verilog%20%24finish">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">TOP.tb_compute_tile.u_compute_tile.gen_cores[0].u_core.u_cpu.bus_gen.ibus_bridge:<span class="ltx_text ltx_lst_space">&nbsp;</span>Wishbone<span class="ltx_text ltx_lst_space">&nbsp;</span>bus<span class="ltx_text ltx_lst_space">&nbsp;</span>IF<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>B3_REGISTERED_FEEDBACK</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">TOP.tb_compute_tile.u_compute_tile.gen_cores[0].u_core.u_cpu.bus_gen.dbus_bridge:<span class="ltx_text ltx_lst_space">&nbsp;</span>Wishbone<span class="ltx_text ltx_lst_space">&nbsp;</span>bus<span class="ltx_text ltx_lst_space">&nbsp;</span>IF<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>B3_REGISTERED_FEEDBACK</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">[<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>22,<span class="ltx_text ltx_lst_space">&nbsp;</span>0]<span class="ltx_text ltx_lst_space">&nbsp;</span>Software<span class="ltx_text ltx_lst_space">&nbsp;</span>reset</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">[<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>63128,<span class="ltx_text ltx_lst_space">&nbsp;</span>0]<span class="ltx_text ltx_lst_space">&nbsp;</span>Terminated<span class="ltx_text ltx_lst_space">&nbsp;</span>at<span class="ltx_text ltx_lst_space">&nbsp;</span>address<span class="ltx_text ltx_lst_space">&nbsp;</span>0x0000e958<span class="ltx_text ltx_lst_space">&nbsp;</span>(status:<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>0)</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">-<span class="ltx_text ltx_lst_space">&nbsp;</span>../src/optimsoc_trace_monitor_trace_monitor/verilog/trace_monitor.sv:89:<span class="ltx_text ltx_lst_space">&nbsp;</span>Verilog<span class="ltx_text ltx_lst_space">&nbsp;</span>$finish</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S1.p14" class="ltx_para">
<p class="ltx_p">Furthermore, you will find a file called <code class="ltx_verbatim ltx_font_typewriter">stdout.000</code> which shows the actual output:</p>
</div>
<div id="S1.p15" class="ltx_para">
<div id="LSTx15" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,#%20OpTiMSoC%20trace_monitor%20stdout%20file%0A#%20%5BTIME,%20CORE%5D%20MESSAGE%0A%5B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2039614,%200%5D%20Hello%20World!%20Core%200%20of%201%20in%20tile%200,%20my%20absolute%20core%20id%20is:%200%0A%5B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2048764,%200%5D%20There%20are%201%20compute%20tiles:%0A%5B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2057162,%200%5D%20%20rank%200%20is%20tile%200">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">#<span class="ltx_text ltx_lst_space">&nbsp;</span>OpTiMSoC<span class="ltx_text ltx_lst_space">&nbsp;</span>trace_monitor<span class="ltx_text ltx_lst_space">&nbsp;</span>stdout<span class="ltx_text ltx_lst_space">&nbsp;</span>file</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">#<span class="ltx_text ltx_lst_space">&nbsp;</span>[TIME,<span class="ltx_text ltx_lst_space">&nbsp;</span>CORE]<span class="ltx_text ltx_lst_space">&nbsp;</span>MESSAGE</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">[<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>39614,<span class="ltx_text ltx_lst_space">&nbsp;</span>0]<span class="ltx_text ltx_lst_space">&nbsp;</span>Hello<span class="ltx_text ltx_lst_space">&nbsp;</span>World!<span class="ltx_text ltx_lst_space">&nbsp;</span>Core<span class="ltx_text ltx_lst_space">&nbsp;</span>0<span class="ltx_text ltx_lst_space">&nbsp;</span>of<span class="ltx_text ltx_lst_space">&nbsp;</span>1<span class="ltx_text ltx_lst_space">&nbsp;</span>in<span class="ltx_text ltx_lst_space">&nbsp;</span>tile<span class="ltx_text ltx_lst_space">&nbsp;</span>0,<span class="ltx_text ltx_lst_space">&nbsp;</span>my<span class="ltx_text ltx_lst_space">&nbsp;</span>absolute<span class="ltx_text ltx_lst_space">&nbsp;</span>core<span class="ltx_text ltx_lst_space">&nbsp;</span>id<span class="ltx_text ltx_lst_space">&nbsp;</span>is:<span class="ltx_text ltx_lst_space">&nbsp;</span>0</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">[<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>48764,<span class="ltx_text ltx_lst_space">&nbsp;</span>0]<span class="ltx_text ltx_lst_space">&nbsp;</span>There<span class="ltx_text ltx_lst_space">&nbsp;</span>are<span class="ltx_text ltx_lst_space">&nbsp;</span>1<span class="ltx_text ltx_lst_space">&nbsp;</span>compute<span class="ltx_text ltx_lst_space">&nbsp;</span>tiles:</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">[<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>57162,<span class="ltx_text ltx_lst_space">&nbsp;</span>0]<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>rank<span class="ltx_text ltx_lst_space">&nbsp;</span>0<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>tile<span class="ltx_text ltx_lst_space"></span></span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S1.p16" class="ltx_para">
<p class="ltx_p">Congratulations, you&rsquo;ve ran your first OpTiMSoC system!</p>
</div>
<div id="S1.p17" class="ltx_para ltx_docnote">
<p class="ltx_p ltx_docnote_title">Note</p>
<p class="ltx_p">If you are already familiar with embedded systems or microcontrollers, you might wonder:
how did the <code class="ltx_verbatim ltx_font_typewriter">printf()</code> output from the software get into the <code class="ltx_verbatim ltx_font_typewriter">stdout.000</code> file if there is no UART or anything similar?</p>
<p class="ltx_p">OpTiMSoC software makes excessive use of a useful part of the OpenRISC ISA. The
&ldquo;no operation&rdquo; instruction <code class="ltx_verbatim ltx_font_typewriter">l.nop</code> has a parameter <code class="ltx_verbatim ltx_font_typewriter">K</code> in assembly.
This can be used for simulation purposes. It can be used for instrumentation,
tracing or special purposes as writing characters with minimal intrusion or
simulation termination.</p>
<p class="ltx_p">The termination is forced with <code class="ltx_verbatim ltx_font_typewriter">l.nop 0x1</code>. The instruction is
observed and a trace monitor terminates when it was observed at all
cores (shortly after <code class="ltx_verbatim ltx_font_typewriter">main</code> returned).</p>
<p class="ltx_p">With this method you can simply provide constants to your simulation
environments. For variables this method is extended by putting data in
further registers (often <code class="ltx_verbatim ltx_font_typewriter">r3</code>). This still is minimally intrusive
and allows you to trace values. The printf is also done that way (see
newlib):</p>
<div id="LSTx16" class="ltx_listingblock ltx_lstlisting ltx_lst_language_C ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,void%20sim_putc(unsigned%20char%20c)%20%7B%0A%20%20asm(%22l.addi%5Ctr3,%0,0%22:%20:%22r%22%20(c));%0A%20%20asm(%22l.nop%20%0%22:%20:%22K%22%20(NOP_PUTC));%0A%7D">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_keyword ltx_font_bold">void</span><span class="ltx_text ltx_lst_space">&nbsp;</span>sim_putc(<span class="ltx_text ltx_lst_keyword ltx_font_bold">unsigned</span><span class="ltx_text ltx_lst_space">&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">char</span><span class="ltx_text ltx_lst_space">&nbsp;</span>c)<span class="ltx_text ltx_lst_space">&nbsp;</span>asm"l.addi\tr3,%0,0":<span class="ltx_text ltx_lst_space">&nbsp;</span>:"r"<span class="ltx_text ltx_lst_space">&nbsp;</span>(c));</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>asm("l.nop<span class="ltx_text ltx_lst_space">&nbsp;</span>%0":<span class="ltx_text ltx_lst_space">&nbsp;</span>:"K"<span class="ltx_text ltx_lst_space">&nbsp;</span>(NOP_PUTC));</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">}</span>
              </td>
</tr>
</table>
</div>
<p class="ltx_p">This function is called from printf as write function. The trace
monitor captures theses characters and puts them to the stdout file.</p>
<p class="ltx_p">You can easily add your own &ldquo;traces&rdquo; using a macro defined in
<span class="ltx_ref ltx_path ltx_ref_self"><span class="ltx_text ltx_font_typewriter">$OPTIMSOC/soc/sw/include/baremetal/optimsoc-baremetal.h</span></span>:</p>
<div id="LSTx17" class="ltx_listingblock ltx_lstlisting ltx_lst_language_C ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,#define%20OPTIMSOC_TRACE(id,v)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%0A%20%20%20asm(%22l.addi%5Ctr3,%0,0%22:%20:%22r%22%20(v)%20:%20%22r3%22);%20%5C%0A%20%20%20asm(%22l.nop%20%0%22:%20:%22K%22%20(id));">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">define<span class="ltx_text ltx_lst_space">&nbsp;</span>OPTIMSOC_TRACE(id,v)<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>\</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>asm("l.addi\tr3,%0,0":<span class="ltx_text ltx_lst_space">&nbsp;</span>:"r"<span class="ltx_text ltx_lst_space">&nbsp;</span>(v)<span class="ltx_text ltx_lst_space">&nbsp;</span>:<span class="ltx_text ltx_lst_space">&nbsp;</span>"r3");<span class="ltx_text ltx_lst_space">&nbsp;</span>\</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>asm("l.nop<span class="ltx_text ltx_lst_space">&nbsp;</span>%0":<span class="ltx_text ltx_lst_space">&nbsp;</span>:"K"<span class="ltx_text ltx_lst_space">&nbsp;</span>(id));</span>
              </td>
</tr>
</table>
</div>
</div>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3.2 </span>See the Waves</h2>

<div id="S2.p1" class="ltx_para">
<p class="ltx_p">One major benefit of simulating a SoC is the possibility to inspect every signal inside the hardware design quite easily.
When running a Verilator simulation, as we did in the previous step, you can simply add the <code class="ltx_verbatim ltx_font_typewriter">--vcd</code> command line option.
It instructs Verilator to write all signals into a file.
You can then start a waveform viewer, like GTKWave to display it.</p>
</div>
<div id="S2.p2" class="ltx_para">
<div id="LSTx18" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,%24OPTIMSOC/examples/sim/compute_tile/compute_tile_sim_singlecore%20--meminit=hello.vmem%20--vcd">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">$OPTIMSOC/examples/sim/compute_tile/compute_tile_sim_singlecore<span class="ltx_text ltx_lst_space">&nbsp;</span>--meminit=hello.vmem<span class="ltx_text ltx_lst_space">&nbsp;</span>--vcd</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S2.p3" class="ltx_para">
<p class="ltx_p">This command will run the hello world example like it did before, but this time Verilator additionally writes a <code class="ltx_verbatim ltx_font_typewriter">sim.vcd</code> waveform file.
You can now view this file.</p>
<div id="LSTx19" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,gtkwave%20sim.vcd">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">gtkwave<span class="ltx_text ltx_lst_space">&nbsp;</span>sim.vcd</span>
              </td>
</tr>
</table>
</div>
<p class="ltx_p">The screenshot in Figure&nbsp;<a href="#F1" title="Figure&nbsp;3.1 &#8227; 3.2 See the Waves &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3.1</span></a> is similar to what you should see when running GTKWave.</p>
</div>
<figure id="F1" class="ltx_figure"><img src="img/screenshot-gtkwave.png" id="F1.g1" class="ltx_graphics ltx_centering" width="541" height="432" alt="">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure&nbsp;3.1: </span>Screenshot of GTKWave displaying some signals from a running <span class="ltx_text ltx_font_typewriter">compute_tile_dm</span> SoC.</figcaption>
</figure>
<div id="S2.p4" class="ltx_para">
<p class="ltx_p">On the left side you find a hierarchy of all signals in the system.
Add them to the wave view and explore all internals of a working SoC at your fingertips!
Can you find the program counter? The instruction and data caches? The branch predictor?</p>
</div>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3.3 </span>Going Multicore: Simulate a Multicore Compute Tile</h2>

<div id="S3.p1" class="ltx_para">
<p class="ltx_p">Next you might want to build an actual multicore system. In a first
step, you can just start simulations of compute tiles with multiple
cores.</p>
</div>
<div id="S3.p2" class="ltx_para">
<p class="ltx_p">Inside <span class="ltx_ref ltx_path ltx_ref_self"><span class="ltx_text ltx_font_typewriter">OPTIMSOC/examples/sim/compute_tile</span></span> you&rsquo;ll find a dual-core version and a quad-core version of the system with just one compute tile that you just simulated in the previous step.
You can run those examples like you did before.</p>
</div>
<div id="S3.p3" class="ltx_para">
<p class="ltx_p">The first thing you observe: the simulation runs become longer.
After each run, inspect the <code class="ltx_verbatim ltx_font_typewriter">stdout.*</code> files.</p>
</div>
<div id="S3.p4" class="ltx_para">
<p class="ltx_p">Welcome to the multicore world!</p>
</div>
</section>
<section id="S4" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3.4 </span>Tiled Multicore SoC: Simulate a Small 2x2 Distributed Memory
System</h2>

<div id="S4.p1" class="ltx_para">
<p class="ltx_p">Next we want to run an actual NoC-based tiled multicore system-on-chip,
with the examples you get <code class="ltx_verbatim ltx_font_typewriter">system_2x2_cccc</code>. The nomenclature in
all pre-packed systems first denotes the dimensions and then the
instantiated tiles, here <code class="ltx_verbatim ltx_font_typewriter">cccc</code> as four compute tiles.
In our pre-built example, each compute tile has two CPU cores, meaning you have eight CPU cores in total.
</p>
</div>
<div id="S4.p2" class="ltx_para">
<p class="ltx_p">Execute it again to get the hello world experience:</p>
</div>
<div id="S4.p3" class="ltx_para">
<div id="LSTx20" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,%24OPTIMSOC/examples/sim/system_2x2_cccc/system_2x2_cccc_sim_dualcore%20--meminit=hello.vmem">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">$OPTIMSOC/examples/sim/system_2x2_cccc/system_2x2_cccc_sim_dualcore<span class="ltx_text ltx_lst_space">&nbsp;</span>--meminit=hello.vmem</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S4.p4" class="ltx_para">
<p class="ltx_p">In our simulation all cores in the four tiles run the same
software. Before you shout &ldquo;that&rsquo;s boring:&rdquo; You can still write
different code depending on which tile and core the software is
executed. A couple of functions are useful for that:</p>
</div>
<div id="S4.p5" class="ltx_para">
<ul id="I2" class="ltx_itemize">
<li id="I2.i1" class="ltx_item">
<div id="I2.i1.p1" class="ltx_para">
<p class="ltx_p"><code class="ltx_verbatim ltx_font_typewriter">optimsoc_get_numct()</code>: The number of compute tiles in the system</p>
</div>
</li>
<li id="I2.i2" class="ltx_item">
<div id="I2.i2.p1" class="ltx_para">
<p class="ltx_p"><code class="ltx_verbatim ltx_font_typewriter">optimsoc_get_numtiles()</code>: The number of tiles (of any type) in
the system</p>
</div>
</li>
<li id="I2.i3" class="ltx_item">
<div id="I2.i3.p1" class="ltx_para">
<p class="ltx_p"><code class="ltx_verbatim ltx_font_typewriter">optimsoc_get_ctrank()</code>: Get the rank of this compute tile in this
system. Essentially this is just a number that uniquely identifies a
compute tile.</p>
</div>
</li>
</ul>
</div>
<div id="S4.p6" class="ltx_para">
<p class="ltx_p">There are more useful utility functions like those available, find them in the
file <span class="ltx_ref ltx_path ltx_ref_self"><span class="ltx_text ltx_font_typewriter">$OPTIMSOC/soc/sw/include/baremetal/optimsoc-baremetal.h</span></span>.</p>
</div>
<div id="S4.p7" class="ltx_para">
<p class="ltx_p">A simple application that uses those functions to do message passing between
the different tiles is <code class="ltx_verbatim ltx_font_typewriter">hello_mpsimple</code>. This program uses
the simple message passing facilities of the network adapter to send messages.
All cores send a message to core 0. If all messages have been received, core 0
prints a message &ldquo;Received all messages. Hello World!&rdquo;.</p>
</div>
<div id="S4.p8" class="ltx_para">
<div id="LSTx21" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,#%20start%20from%20the%20the%20baremetal-apps%20source%20code%20directory%0Acd%20hello_mpsimple%0Amake%0A%24OPTIMSOC/examples/sim/system_2x2_cccc/system_2x2_cccc_sim_dualcore%20--meminit=hello_mpsimple.vmem">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">#<span class="ltx_text ltx_lst_space">&nbsp;</span>start<span class="ltx_text ltx_lst_space">&nbsp;</span>from<span class="ltx_text ltx_lst_space">&nbsp;</span>the<span class="ltx_text ltx_lst_space">&nbsp;</span>the<span class="ltx_text ltx_lst_space">&nbsp;</span>baremetal-apps<span class="ltx_text ltx_lst_space">&nbsp;</span>source<span class="ltx_text ltx_lst_space">&nbsp;</span>code<span class="ltx_text ltx_lst_space">&nbsp;</span>directory</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">cd<span class="ltx_text ltx_lst_space">&nbsp;</span>hello_mpsimple</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">make</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">$OPTIMSOC/examples/sim/system_2x2_cccc/system_2x2_cccc_sim_dualcore<span class="ltx_text ltx_lst_space">&nbsp;</span>--meminit=hello_mpsimple.vmem</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S4.p9" class="ltx_para">
<p class="ltx_p">Have a look what the software does (you find the code in
<span class="ltx_ref ltx_path ltx_ref_self"><span class="ltx_text ltx_font_typewriter">hello_mpsimple.c</span></span>). Let&rsquo;s
first check the output of core 0.</p>
</div>
<div id="S4.p10" class="ltx_para">
<div id="LSTx22" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,%24&gt;%20cat%20stdout.000%0A#%20OpTiMSoC%20trace_monitor%20stdout%20file%0A#%20%5BTIME,%20CORE%5D%20MESSAGE%0A%5B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2042844,%200%5D%20Wait%20for%203%20messages%0A%5B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2048734,%200%5D%20Received%20all%20messages.%20Hello%20World!">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">$&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">cat</span><span class="ltx_text ltx_lst_space">&nbsp;</span>stdout.000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter ltx_font_italic">#<span class="ltx_text ltx_lst_space">&nbsp;</span>OpTiMSoC<span class="ltx_text ltx_lst_space">&nbsp;</span>trace_monitor<span class="ltx_text ltx_lst_space">&nbsp;</span>stdout<span class="ltx_text ltx_lst_space">&nbsp;</span>file</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter ltx_font_italic">#<span class="ltx_text ltx_lst_space">&nbsp;</span>[TIME,<span class="ltx_text ltx_lst_space">&nbsp;</span>CORE]<span class="ltx_text ltx_lst_space">&nbsp;</span>MESSAGE</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">[<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>42844,<span class="ltx_text ltx_lst_space">&nbsp;</span>0]<span class="ltx_text ltx_lst_space">&nbsp;</span>Wait<span class="ltx_text ltx_lst_space">&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">for</span><span class="ltx_text ltx_lst_space">&nbsp;</span>3<span class="ltx_text ltx_lst_space">&nbsp;</span>messages</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">[<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>48734,<span class="ltx_text ltx_lst_space">&nbsp;</span>0]<span class="ltx_text ltx_lst_space">&nbsp;</span>Received<span class="ltx_text ltx_lst_space">&nbsp;</span>all<span class="ltx_text ltx_lst_space">&nbsp;</span>messages.<span class="ltx_text ltx_lst_space">&nbsp;</span>Hello<span class="ltx_text ltx_lst_space">&nbsp;</span>World!</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S4.p11" class="ltx_para">
<p class="ltx_p">Finally, let&rsquo;s have a quick glance at a more realistic application:
<code class="ltx_verbatim ltx_font_typewriter">heat_mpsimple</code>. You can find it in the same place as the previous
applications, <code class="ltx_verbatim ltx_font_typewriter">hello</code> and <code class="ltx_verbatim ltx_font_typewriter">hello_mpsimple</code>. The application
calculates the heat distribution in a distributed manner. The cores coordinate
their boundary regions by sending messages around.</p>
</div>
<div id="S4.p12" class="ltx_para">
<p class="ltx_p">Can you compile this application and run it? Don&rsquo;t get nervous, the simulation
can take a couple of minutes to finish. Have a look at the source code and try
to understand what&rsquo;s going on. Also have a look at the <code class="ltx_verbatim ltx_font_typewriter">stdout</code> log files.
Core 0 will also print the complete heat distribution at the end.</p>
</div>
</section>
<section id="S5" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3.5 </span>Observing Software During Execution: The Debug System</h2>

<div id="S5.p1" class="ltx_para">
<p class="ltx_p">Up to now, you have seen the output of the software that runs on your SoC.
And you had a look deep into the inner works of the SoC by looking at the waveforms.</p>
</div>
<div id="S5.p2" class="ltx_para">
<p class="ltx_p">In a real-world system, you need something in between: a way to observe the software as it executes on a chip, but without observing or understanding all the signals inside the hardware.
This is what the debug system provides: hardware inside the chip which allows you to observe what&rsquo;s going on during software execution.</p>
</div>
<div id="S5.p3" class="ltx_para">
<p class="ltx_p">OpTiMSoC also comes with an extensive debug system. In this section, we&rsquo;ll have
a look at this system, how it works and how you can use it to debug your
applications. But before diving into the details, we&rsquo;ll have a short discussion
of the basics which are necessary to understand the system.</p>
</div>
<div id="S5.p4" class="ltx_para">
<p class="ltx_p">Many developers know debugging from their daily work. Most of the time it
involves running a program inside a debugger like GDB or Microsoft Visual
Studio, setting a breakpoint at the right line of code, and stepping through the
program from there on, running one instruction (or one line of code) at a time.</p>
</div>
<div id="S5.p5" class="ltx_para">
<p class="ltx_p">This technique is what we call run-control debugging. While it works great for
single-threaded programs, it cannot easily be applied to debugging parallel
software running on possibly heterogeneous many-core SoC.
Instead, the debug support in OpTiMSoC mainly relies on tracing.
Tracing does not stop or otherwise influence the SoC itself; it only &ldquo;records&rdquo; what&rsquo;s going on during software execution, and transmits this data to the developer.</p>
</div>
<div id="S5.p6" class="ltx_para">
<p class="ltx_p">The debug system consists of two main parts: the hardware part runs on the
OpTiMSoC system itself and collects all data. The other part runs on a
developer&rsquo;s PC (often also called host PC) and controls the debugging process
and displays the collected data.</p>
</div>
<div id="S5.p7" class="ltx_para">
<p class="ltx_p">After this introduction, let&rsquo;s make use of the debug system to obtain various traces.
Just like in the previous examples, our SoC hardware is still running in Verilator.
This tutorial works best if you have multiple terminal windows open at the same time, as we&rsquo;ll need to have multiple programs running at the same time.</p>
</div>
<div id="S5.p8" class="ltx_para">
<p class="ltx_p">So, open a new terminal (or a new tab inside your terminal), and start the simulation of the SoC hardware.
</p>
<div id="LSTx23" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,%24OPTIMSOC/examples/sim/system_2x2_cccc/system_2x2_cccc_sim_dualcore_debug">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">$OPTIMSOC/examples/sim/system_2x2_cccc/system_2x2_cccc_sim_dualcore_debug</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S5.p9" class="ltx_para">
<p class="ltx_p">You&rsquo;ll see a lot of &ldquo;Software reset&rdquo; messages; that&rsquo;s expected.</p>
</div>
<div id="S5.p10" class="ltx_para">
<p class="ltx_p">Now, open a second terminal (leave the first one running!) and type</p>
<div id="LSTx24" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,opensocdebugd%20tcp">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">opensocdebugd<span class="ltx_text ltx_lst_space">&nbsp;</span>tcp</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S5.p11" class="ltx_para">
<p class="ltx_p">This starts the &ldquo;Open SoC Debug daemon.&rdquo;
Open SoC Debug (or short, OSD) is the name of the debug infrastructure that&rsquo;s included with OpTiMSoC.
The Open SoC Debug daemon is a tool which connects to the debug system inside the SoC hardware and interacts with it.
In our case, since the SoC is running inside the Verilator simulation on the same PC, we use TCP to connect the simulated hardware <code class="ltx_verbatim ltx_font_typewriter">opensocdebugd</code>.
Later, if we run the hardware on an FPGA, we&rsquo;ll use UART or USB instead of TCP &ndash; but all the commands stay the same.</p>
</div>
<div id="S5.p12" class="ltx_para">
<p class="ltx_p">After some seconds, <code class="ltx_verbatim ltx_font_typewriter">opensocdebugd</code> will output something like this.</p>
</div>
<div id="S5.p13" class="ltx_para">
<div id="LSTx25" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,Open%20SoC%20Debug%20Daemon%0ABackend:%20tcp%0ASystem%20ID:%200001%0A22%20debug%20modules%20found:%0A%20%5B0%5D:%20HOST%0A%20%20%20version:%200000%0A%20%5B1%5D:%20SCM%0A%20%20%20version:%200000%0A%20%5B2%5D:%20MAM%0A%20%20%20version:%200000%0A%20%20%20data%20width:%2032,%20address%20width:%2032%0A%20%20%20number%20of%20regions:%201%0A%20%20%20%20%20%5B0%5D%20base%20address:%200x0000000000000000,%20memory%20size:%2033554432%20Bytes%0A%20%5B3%5D:%20STM%0A%20%20%20version:%200000%0A%20%20%20xlen:%2032%0A%20%5B4%5D:%20CTM%0A%20%20%20version:%200000%0A%20%20%20addr_width:%2032%0A%20%20%20data_width:%2032%0A%20%5B5%5D:%20STM%0A%20%20%20version:%200000%0A%20%20%20xlen:%2032%0A%20%5B6%5D:%20CTM%0A%20%20%20version:%200000%0A%20%20%20addr_width:%2032%0A%20%20%20data_width:%2032%0A%20%5B7%5D:%20MAM%0A%20%20%20version:%200000%0A%20%20%20data%20width:%2032,%20address%20width:%2032%0A%20%20%20number%20of%20regions:%201%0A%20%20%20%20%20%5B0%5D%20base%20address:%200x0000000000000000,%20memory%20size:%2033554432%20Bytes%0A%20%5B8%5D:%20STM%0A%20%20%20version:%200000%0A%20%20%20xlen:%2032%0A%20%5B9%5D:%20CTM%0A%20%20%20version:%200000%0A%20%20%20addr_width:%2032%0A%20%20%20data_width:%2032%0A%20%5B10%5D:%20STM%0A%20%20%20version:%200000%0A%20%20%20xlen:%2032%0A%20%5B11%5D:%20CTM%0A%20%20%20version:%200000%0A%20%20%20addr_width:%2032%0A%20%20%20data_width:%2032%0A...%20(we've%20skipped%20some%20output%20here)%20...%0AWait%20for%20connection">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">Open<span class="ltx_text ltx_lst_space">&nbsp;</span>SoC<span class="ltx_text ltx_lst_space">&nbsp;</span>Debug<span class="ltx_text ltx_lst_space">&nbsp;</span>Daemon</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">Backend:<span class="ltx_text ltx_lst_space">&nbsp;</span>tcp</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">System<span class="ltx_text ltx_lst_space">&nbsp;</span>ID:<span class="ltx_text ltx_lst_space">&nbsp;</span>0001</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">22<span class="ltx_text ltx_lst_space">&nbsp;</span>debug<span class="ltx_text ltx_lst_space">&nbsp;</span>modules<span class="ltx_text ltx_lst_space">&nbsp;</span>found:</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[0]:<span class="ltx_text ltx_lst_space">&nbsp;</span>HOST</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[1]:<span class="ltx_text ltx_lst_space">&nbsp;</span>SCM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[2]:<span class="ltx_text ltx_lst_space">&nbsp;</span>MAM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>data<span class="ltx_text ltx_lst_space">&nbsp;</span>width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32,<span class="ltx_text ltx_lst_space">&nbsp;</span>address<span class="ltx_text ltx_lst_space">&nbsp;</span>width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>number<span class="ltx_text ltx_lst_space">&nbsp;</span>of<span class="ltx_text ltx_lst_space">&nbsp;</span>regions:<span class="ltx_text ltx_lst_space">&nbsp;</span>1</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>[0]<span class="ltx_text ltx_lst_space">&nbsp;</span>base<span class="ltx_text ltx_lst_space">&nbsp;</span>address:<span class="ltx_text ltx_lst_space">&nbsp;</span>0x0000000000000000,<span class="ltx_text ltx_lst_space">&nbsp;</span>memory<span class="ltx_text ltx_lst_space">&nbsp;</span>size:<span class="ltx_text ltx_lst_space">&nbsp;</span>33554432<span class="ltx_text ltx_lst_space">&nbsp;</span>Bytes</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[3]:<span class="ltx_text ltx_lst_space">&nbsp;</span>STM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>xlen:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[4]:<span class="ltx_text ltx_lst_space">&nbsp;</span>CTM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>addr_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>data_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[5]:<span class="ltx_text ltx_lst_space">&nbsp;</span>STM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>xlen:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[6]:<span class="ltx_text ltx_lst_space">&nbsp;</span>CTM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>addr_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>data_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[7]:<span class="ltx_text ltx_lst_space">&nbsp;</span>MAM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>data<span class="ltx_text ltx_lst_space">&nbsp;</span>width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32,<span class="ltx_text ltx_lst_space">&nbsp;</span>address<span class="ltx_text ltx_lst_space">&nbsp;</span>width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>number<span class="ltx_text ltx_lst_space">&nbsp;</span>of<span class="ltx_text ltx_lst_space">&nbsp;</span>regions:<span class="ltx_text ltx_lst_space">&nbsp;</span>1</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>[0]<span class="ltx_text ltx_lst_space">&nbsp;</span>base<span class="ltx_text ltx_lst_space">&nbsp;</span>address:<span class="ltx_text ltx_lst_space">&nbsp;</span>0x0000000000000000,<span class="ltx_text ltx_lst_space">&nbsp;</span>memory<span class="ltx_text ltx_lst_space">&nbsp;</span>size:<span class="ltx_text ltx_lst_space">&nbsp;</span>33554432<span class="ltx_text ltx_lst_space">&nbsp;</span>Bytes</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[8]:<span class="ltx_text ltx_lst_space">&nbsp;</span>STM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>xlen:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[9]:<span class="ltx_text ltx_lst_space">&nbsp;</span>CTM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>addr_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>data_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[10]:<span class="ltx_text ltx_lst_space">&nbsp;</span>STM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>xlen:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;</span>[11]:<span class="ltx_text ltx_lst_space">&nbsp;</span>CTM</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>version:<span class="ltx_text ltx_lst_space">&nbsp;</span>0000</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>addr_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;</span>data_width:<span class="ltx_text ltx_lst_space">&nbsp;</span>32</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">...<span class="ltx_text ltx_lst_space">&nbsp;</span>(we've<span class="ltx_text ltx_lst_space">&nbsp;</span>skipped<span class="ltx_text ltx_lst_space">&nbsp;</span>some<span class="ltx_text ltx_lst_space">&nbsp;</span>output<span class="ltx_text ltx_lst_space">&nbsp;</span>here)<span class="ltx_text ltx_lst_space">&nbsp;</span>...</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">Wait<span class="ltx_text ltx_lst_space">&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">for</span><span class="ltx_text ltx_lst_space">&nbsp;</span>connection</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S5.p14" class="ltx_para">
<p class="ltx_p">What you see is the output of the &ldquo;debug system enumeration.&rdquo;
Internally, the debug system consists of many modules.
When first started, <code class="ltx_verbatim ltx_font_typewriter">opensocdebugd</code> first asks the SoC hardware for all available modules and prints them out.
Without going into too much details, the most important ones are the following ones.</p>
<ul id="I3" class="ltx_itemize">
<li id="I3.i1" class="ltx_item">
<div id="I3.i1.p1" class="ltx_para">
<p class="ltx_p">The Memory Access Module (MAM) allows us to write and read memories inside the SoC from the host.
We&rsquo;ll make use of this in a bit to load our software into the SoC.</p>
</div>
</li>
<li id="I3.i2" class="ltx_item">
<div id="I3.i2.p1" class="ltx_para">
<p class="ltx_p">The System Trace Module (STM) is mainly responsible to transmit the output of all <code class="ltx_verbatim ltx_font_typewriter">printf()</code> calls to the host PC.</p>
</div>
</li>
<li id="I3.i3" class="ltx_item">
<div id="I3.i3.p1" class="ltx_para">
<p class="ltx_p">The Core Trace Module (CTM) observes the software execution on the processor.
We use it mainly to generate a function trace, i.e. a list of all software functions which have been called.</p>
</div>
</li>
</ul>
</div>
<div id="S5.p15" class="ltx_para">
<p class="ltx_p">Why is there not just one of each modules?
We&rsquo;re running a system with four tiles, each with two CPU cores.
There are so many modules, because some of the debug modules are part of a tile, and some are attached to each CPU core.
So this explains why there are four MAM modules, and eight CTM and STM modules each.</p>
</div>
<div id="S5.p16" class="ltx_para">
<p class="ltx_p">Let&rsquo;s go back to our terminals.
Up to now we have two terminals open, let&rsquo;s open a third one.
In here, we start <code class="ltx_verbatim ltx_font_typewriter">osd-cli</code>, a command line application that allows you to interact with the SoC hardware.</p>
<div id="LSTx26" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,osd-cli">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd-cli</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S5.p17" class="ltx_para">
<p class="ltx_p"><code class="ltx_verbatim ltx_font_typewriter">osd-cli</code> supports many commands, and the <code class="ltx_verbatim ltx_font_typewriter">help</code> command is probably a good starting point.</p>
</div>
<div id="S5.p18" class="ltx_para">
<div id="LSTx27" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,osd&gt;%20help%0AAvailable%20commands:%0A%20%20help%20%20%20%20%20%20%20%20Print%20this%20help%0A%20%20&lt;cmd&gt;%20help%20%20Print%20help%20for%20command%0A%20%20quit%20%20%20%20%20%20%20%20Exit%20the%20command%20line%0A%20%20reset%20%20%20%20%20%20%20Reset%20the%20system%0A%20%20start%20%20%20%20%20%20%20Start%20the%20processor%20cores%0A%20%20mem%20%20%20%20%20%20%20%20%20Access%20memory%0A%20%20ctm%20%20%20%20%20%20%20%20%20Configure%20core%20trace%20module%0A%20%20stm%20%20%20%20%20%20%20%20%20Configure%20software%20trace%20module%0A%20%20terminal%20%20%20%20Start%20terminal%20for%20device%20emulation%20module%0A%20%20wait%20%20%20%20%20%20%20%20Wait%20for%20given%20seconds%0Aosd&gt;%20mem%20help%0AAvailable%20subcommands:%0A%20%20help%20%20%20%20%20%20%20%20Print%20this%20help%0A%20%20test%20%20%20%20%20%20%20%20Run%20memory%20tests%0A%20%20loadelf%20%20%20%20%20Load%20an%20elf%20to%20memory">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>help</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">Available<span class="ltx_text ltx_lst_space">&nbsp;</span>commands:</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>help<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Print<span class="ltx_text ltx_lst_space">&nbsp;</span>this<span class="ltx_text ltx_lst_space">&nbsp;</span>help</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>&lt;cmd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>help<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>Print<span class="ltx_text ltx_lst_space">&nbsp;</span>help<span class="ltx_text ltx_lst_space">&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">for</span><span class="ltx_text ltx_lst_space">&nbsp;</span>command</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>quit<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">Exit</span><span class="ltx_text ltx_lst_space">&nbsp;</span>the<span class="ltx_text ltx_lst_space">&nbsp;</span>command<span class="ltx_text ltx_lst_space">&nbsp;</span>line</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>reset<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Reset<span class="ltx_text ltx_lst_space">&nbsp;</span>the<span class="ltx_text ltx_lst_space">&nbsp;</span>system</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>start<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Start<span class="ltx_text ltx_lst_space">&nbsp;</span>the<span class="ltx_text ltx_lst_space">&nbsp;</span>processor<span class="ltx_text ltx_lst_space">&nbsp;</span>cores</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>mem<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Access<span class="ltx_text ltx_lst_space">&nbsp;</span>memory</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>ctm<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Configure<span class="ltx_text ltx_lst_space">&nbsp;</span>core<span class="ltx_text ltx_lst_space">&nbsp;</span>trace<span class="ltx_text ltx_lst_space">&nbsp;</span>module</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>stm<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Configure<span class="ltx_text ltx_lst_space">&nbsp;</span>software<span class="ltx_text ltx_lst_space">&nbsp;</span>trace<span class="ltx_text ltx_lst_space">&nbsp;</span>module</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>terminal<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;</span>Start<span class="ltx_text ltx_lst_space">&nbsp;</span>terminal<span class="ltx_text ltx_lst_space">&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">for</span><span class="ltx_text ltx_lst_space">&nbsp;</span>device<span class="ltx_text ltx_lst_space">&nbsp;</span>emulation<span class="ltx_text ltx_lst_space">&nbsp;</span>module</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>wait<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Wait<span class="ltx_text ltx_lst_space">&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">for</span><span class="ltx_text ltx_lst_space">&nbsp;</span>given<span class="ltx_text ltx_lst_space">&nbsp;</span>seconds</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>mem<span class="ltx_text ltx_lst_space">&nbsp;</span>help</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">Available<span class="ltx_text ltx_lst_space">&nbsp;</span>subcommands:</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>help<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Print<span class="ltx_text ltx_lst_space">&nbsp;</span>this<span class="ltx_text ltx_lst_space">&nbsp;</span>help</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span><span class="ltx_text ltx_lst_keyword ltx_font_bold">test</span><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Run<span class="ltx_text ltx_lst_space">&nbsp;</span>memory<span class="ltx_text ltx_lst_space">&nbsp;</span>tests</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>loadelf<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Load<span class="ltx_text ltx_lst_space">&nbsp;</span>an<span class="ltx_text ltx_lst_space">&nbsp;</span>elf<span class="ltx_text ltx_lst_space">&nbsp;</span>to<span class="ltx_text ltx_lst_space">&nbsp;</span>memory</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S5.p19" class="ltx_para">
<p class="ltx_p">Now let&rsquo;s run our hello world software on the SoC.</p>
</div>
<div id="S5.p20" class="ltx_para">
<ul id="I4" class="ltx_itemize">
<li id="I4.i1" class="ltx_item">
<div id="I4.i1.p1" class="ltx_para">
<p class="ltx_p">First, we reset and then halt all CPUs.
This gives us a &ldquo;silent&rdquo; system, i.e. nothing is running and we can modify the memory without being disturbed by the CPUs.</p>
<div id="LSTx28" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,osd&gt;%20reset%20-halt">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>reset<span class="ltx_text ltx_lst_space">&nbsp;</span>-halt</span>
                    </td>
</tr>
</table>
</div>
</div>
</li>
<li id="I4.i2" class="ltx_item">
<div id="I4.i2.p1" class="ltx_para">
<p class="ltx_p">Next, we load the ELF file of the hello world program into the memory of compute tile 0.
To do this, we tell the MAM module with ID 2 to write the file into the memory. (See the output of opensocdebugd for all IDs that are available.)
After writing, the <code class="ltx_verbatim ltx_font_typewriter">-verify</code> option instructs <code class="ltx_verbatim ltx_font_typewriter">osd-cli</code> to read back all memory content and check if the read data is equal to the written data.
This step is not strictly necessary, but is helpful to check that the memory write was successful indeed.</p>
<div id="LSTx29" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,osd&gt;%20mem%20loadelf%20hello.elf%202%20-verify%0AVerify:%201%0ALoad%20program%20header%200%0ALoad%20program%20header%201%0AVerify%20program%20header%200%0AVerify%20program%20header%201">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>mem<span class="ltx_text ltx_lst_space">&nbsp;</span>loadelf<span class="ltx_text ltx_lst_space">&nbsp;</span>hello.elf<span class="ltx_text ltx_lst_space">&nbsp;</span>2<span class="ltx_text ltx_lst_space">&nbsp;</span>-verify</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">Verify:<span class="ltx_text ltx_lst_space">&nbsp;</span>1</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">Load<span class="ltx_text ltx_lst_space">&nbsp;</span>program<span class="ltx_text ltx_lst_space">&nbsp;</span>header<span class="ltx_text ltx_lst_space">&nbsp;</span>0</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">Load<span class="ltx_text ltx_lst_space">&nbsp;</span>program<span class="ltx_text ltx_lst_space">&nbsp;</span>header<span class="ltx_text ltx_lst_space">&nbsp;</span>1</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">Verify<span class="ltx_text ltx_lst_space">&nbsp;</span>program<span class="ltx_text ltx_lst_space">&nbsp;</span>header<span class="ltx_text ltx_lst_space">&nbsp;</span>0</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">Verify<span class="ltx_text ltx_lst_space">&nbsp;</span>program<span class="ltx_text ltx_lst_space">&nbsp;</span>header<span class="ltx_text ltx_lst_space">&nbsp;</span>1</span>
                    </td>
</tr>
</table>
</div>
</div>
</li>
<li id="I4.i3" class="ltx_item">
<div id="I4.i3.p1" class="ltx_para">
<p class="ltx_p">Before we start the system, we want to observe what&rsquo;s going on when the software is executed.
We therefore instruct the STM and CTM modules of core 0 to write log files.
To the CTM we also pass the ELF file, i.e. the program that is executed.
The CTM can use the information inside this file to record not only the program counter that is executed, but also tell you which function (as written inside the C code) a program counter refers to.
This makes the CTM logs much nicer to read (at least for humans).</p>
</div>
<div id="I4.i3.p2" class="ltx_para">
<div id="LSTx30" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,osd&gt;%20stm%20log%20stm000.log%203%0Aosd&gt;%20ctm%20log%20ctm000.log%204%20hello.elf">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>stm<span class="ltx_text ltx_lst_space">&nbsp;</span>log<span class="ltx_text ltx_lst_space">&nbsp;</span>stm000.log<span class="ltx_text ltx_lst_space">&nbsp;</span>3</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>ctm<span class="ltx_text ltx_lst_space">&nbsp;</span>log<span class="ltx_text ltx_lst_space">&nbsp;</span>ctm000.log<span class="ltx_text ltx_lst_space">&nbsp;</span>4<span class="ltx_text ltx_lst_space">&nbsp;</span>hello.elf</span>
                    </td>
</tr>
</table>
</div>
</div>
</li>
<li id="I4.i4" class="ltx_item">
<div id="I4.i4.p1" class="ltx_para">
<p class="ltx_p">Finally, we are ready to start the system, i.e. lower the reset signal.
</p>
<div id="LSTx31" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,osd&gt;%20start%0Aosd&gt;%20%5BSTM%20003%5D%20004616b5%20Hello%20World!%20Core%200%20of%202%20in%20tile%200,%20my%20absolute%20core%20id%20is:%200%0A%5BSTM%20003%5D%200046266e%20There%20are%204%20compute%20tiles:%0A%5BSTM%20003%5D%2000463792%20%20rank%200%20is%20tile%200%0A%5BSTM%20003%5D%200046484d%20%20rank%201%20is%20tile%201%0A%5BSTM%20003%5D%2000465918%20%20rank%202%20is%20tile%202%0A%5BSTM%20003%5D%20004669ea%20%20rank%203%20is%20tile%203">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>start</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>[STM<span class="ltx_text ltx_lst_space">&nbsp;</span>003]<span class="ltx_text ltx_lst_space">&nbsp;</span>004616b5<span class="ltx_text ltx_lst_space">&nbsp;</span>Hello<span class="ltx_text ltx_lst_space">&nbsp;</span>World!<span class="ltx_text ltx_lst_space">&nbsp;</span>Core<span class="ltx_text ltx_lst_space">&nbsp;</span>0<span class="ltx_text ltx_lst_space">&nbsp;</span>of<span class="ltx_text ltx_lst_space">&nbsp;</span>2<span class="ltx_text ltx_lst_space">&nbsp;</span>in<span class="ltx_text ltx_lst_space">&nbsp;</span>tile<span class="ltx_text ltx_lst_space">&nbsp;</span>0,<span class="ltx_text ltx_lst_space">&nbsp;</span>my<span class="ltx_text ltx_lst_space">&nbsp;</span>absolute<span class="ltx_text ltx_lst_space">&nbsp;</span>core<span class="ltx_text ltx_lst_space">&nbsp;</span>id<span class="ltx_text ltx_lst_space">&nbsp;</span>is:<span class="ltx_text ltx_lst_space">&nbsp;</span>0</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">[STM<span class="ltx_text ltx_lst_space">&nbsp;</span>003]<span class="ltx_text ltx_lst_space">&nbsp;</span>0046266e<span class="ltx_text ltx_lst_space">&nbsp;</span>There<span class="ltx_text ltx_lst_space">&nbsp;</span>are<span class="ltx_text ltx_lst_space">&nbsp;</span>4<span class="ltx_text ltx_lst_space">&nbsp;</span>compute<span class="ltx_text ltx_lst_space">&nbsp;</span>tiles:</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">[STM<span class="ltx_text ltx_lst_space">&nbsp;</span>003]<span class="ltx_text ltx_lst_space">&nbsp;</span>00463792<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>rank<span class="ltx_text ltx_lst_space">&nbsp;</span>0<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>tile<span class="ltx_text ltx_lst_space">&nbsp;</span>0</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">[STM<span class="ltx_text ltx_lst_space">&nbsp;</span>003]<span class="ltx_text ltx_lst_space">&nbsp;</span>0046484d<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>rank<span class="ltx_text ltx_lst_space">&nbsp;</span>1<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>tile<span class="ltx_text ltx_lst_space">&nbsp;</span>1</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">[STM<span class="ltx_text ltx_lst_space">&nbsp;</span>003]<span class="ltx_text ltx_lst_space">&nbsp;</span>00465918<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>rank<span class="ltx_text ltx_lst_space">&nbsp;</span>2<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>tile<span class="ltx_text ltx_lst_space">&nbsp;</span>2</span>
                    </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">[STM<span class="ltx_text ltx_lst_space">&nbsp;</span>003]<span class="ltx_text ltx_lst_space">&nbsp;</span>004669ea<span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>rank<span class="ltx_text ltx_lst_space">&nbsp;</span>3<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>tile<span class="ltx_text ltx_lst_space">&nbsp;</span>3</span>
                    </td>
</tr>
</table>
</div>
</div>
<div id="I4.i4.p2" class="ltx_para">
<p class="ltx_p">Since we have written our hello world program only to core 0, we only get the <code class="ltx_verbatim ltx_font_typewriter">printf()</code> output from this core.</p>
</div>
</li>
<li id="I4.i5" class="ltx_item">
<div id="I4.i5.p1" class="ltx_para">
<p class="ltx_p">Now that the software has finished, we can close the connection by typing</p>
<div id="LSTx32" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,osd&gt;%20quit">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                      <span class="ltx_text ltx_lst_line ltx_font_typewriter">osd&gt;<span class="ltx_text ltx_lst_space">&nbsp;</span>quit</span>
                    </td>
</tr>
</table>
</div>
</div>
</li>
</ul>
</div>
<div id="S5.p21" class="ltx_para">
<p class="ltx_p">Remember that we instructed the STM and CTM modules to write log files?
Have a look at the files <code class="ltx_verbatim ltx_font_typewriter">stm000.log</code> and <code class="ltx_verbatim ltx_font_typewriter">ctm000.log</code> to find all STM and CTM messages that were issued by the system.
If possible the modules already assemble them back together to be more useful to the human user.
For example, the STM creates the <code class="ltx_verbatim ltx_font_typewriter">printf()</code> output out of the trace messages (and you see both inside the file).
The CTM uses the passed ELF file to resolve the function names that you see in the log file.</p>
</div>
</section>
<section id="S6" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3.6 </span>Automating System Interaction</h2>

<div id="S6.p1" class="ltx_para">
<p class="ltx_p">In the previous section, you have manually typed commands into <code class="ltx_verbatim ltx_font_typewriter">osd-cli</code> to interact with the debug system.
We understand that this is something you don&rsquo;t want to do all day.
To make things easier, our debug components come with a Python interface that you can use to automate all the steps.
To make it even more easy, you can use an example script that does exactly what you just typed manually: load all memories of a system and start the CPUs.
The script then waits for ten seconds before it closes the connection to the <code class="ltx_verbatim ltx_font_typewriter">opensocdebugd</code>.
(If your application runs longer than that adjust the script accordingly.)</p>
</div>
<div id="S6.p2" class="ltx_para">
<div id="LSTx33" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,#%20only%20Python%202%20is%20supported%20at%20the%20moment%0Apython2%20%24OPTIMSOC/host/share/opensocdebug/examples/runelf.py%20hello.elf">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter ltx_font_italic">#<span class="ltx_text ltx_lst_space">&nbsp;</span>only<span class="ltx_text ltx_lst_space">&nbsp;</span>Python<span class="ltx_text ltx_lst_space">&nbsp;</span>2<span class="ltx_text ltx_lst_space">&nbsp;</span>is<span class="ltx_text ltx_lst_space">&nbsp;</span>supported<span class="ltx_text ltx_lst_space">&nbsp;</span>at<span class="ltx_text ltx_lst_space">&nbsp;</span>the<span class="ltx_text ltx_lst_space">&nbsp;</span>moment</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">python2<span class="ltx_text ltx_lst_space">&nbsp;</span>$OPTIMSOC/host/share/opensocdebug/examples/runelf.py<span class="ltx_text ltx_lst_space">&nbsp;</span>hello.elf</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S6.p3" class="ltx_para">
<p class="ltx_p">This ends our experiments with SoCs running as Verilator simulation.
In the next sections, we&rsquo;ll move to an FPGA board and see how we can run software on that.</p>
</div>
</section>
<section id="S7" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3.7 </span>Our SoC on an FPGA</h2>

<div id="S7.p1" class="ltx_para">
<p class="ltx_p">Welcome to the fun of real hardware!
Before we can get started, you need to clarify some prerequisites.</p>
</div>
<section id="S7.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.7.1 </span>Prerequisites: FPGA board and Vivado</h3>

<div id="S7.SS1.p1" class="ltx_para">
<p class="ltx_p">This, of course, first means that you need borrow, buy or otherwise obtain an FPGA board.
In this tutorial, we use the Nexys 4 DDR board by Xilinx/Digilent.
It&rsquo;s not that expensive (of course, depending on your financial situation) and widely available.
If you need help obtaining one, let us know &ndash; maybe we can help out in some way.</p>
</div>
<div id="S7.SS1.p2" class="ltx_para">
<p class="ltx_p">Additionally you need to download and install the Xilinx Vivado tool (the cost-free WebPack license is sufficient).
We used the 2016.2 version when preparing this tutorial; we strongly recommend you also use this exact version.</p>
</div>
<div id="S7.SS1.p3" class="ltx_para">
<p class="ltx_p">Once you have obtained the FPGA board, connect it to the PC on the &ldquo;PROG UART&rdquo; USB connection.
You don&rsquo;t need to connect any additional power supply.</p>
</div>
</section>
<section id="S7.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.7.2 </span>Programming the FPGA</h3>

<div id="S7.SS2.p1" class="ltx_para">
<p class="ltx_p">With the board connected, we can program (or &ldquo;flash&rdquo;) the FPGA with our hardware design, the &ldquo;bitstream.&rdquo;
The OpTiMSoC release contains pre-built bitstreams for the single compute tile system and a 2x2 system with four compute tiles, meaning we can start directly with programming the FPGA.</p>
</div>
<div id="S7.SS2.p2" class="ltx_para">
<p class="ltx_p">To program the FPGA we&rsquo;ll use Vivado.</p>
<ul id="I5" class="ltx_itemize">
<li id="I5.i1" class="ltx_item">
<div id="I5.i1.p1" class="ltx_para">
<p class="ltx_p">Open Vivado (e.g. by typing <code class="ltx_verbatim ltx_font_typewriter">vivado</code> into a terminal window)</p>
</div>
</li>
<li id="I5.i2" class="ltx_item">
<div id="I5.i2.p1" class="ltx_para">
<p class="ltx_p">On the welcome screen, click on &ldquo;Hardware Manager&rdquo;</p>
</div>
</li>
<li id="I5.i3" class="ltx_item">
<div id="I5.i3.p1" class="ltx_para">
<p class="ltx_p">Ensure that your Nexys4 DDR board is plugged into your PC and is turned on.</p>
</div>
</li>
<li id="I5.i4" class="ltx_item">
<div id="I5.i4.p1" class="ltx_para">
<p class="ltx_p">Click on &ldquo;Open Target&rdquo; in the green bar on the top, and then on &ldquo;Auto Connect&rdquo;</p>
</div>
</li>
<li id="I5.i5" class="ltx_item">
<div id="I5.i5.p1" class="ltx_para">
<p class="ltx_p">Now click on &ldquo;Program Device&rdquo; in the same green bar and select the only option &ldquo;xc7a100t_0&rdquo; (that&rsquo;s the FPGA on the board).</p>
</div>
</li>
<li id="I5.i6" class="ltx_item">
<div id="I5.i6.p1" class="ltx_para">
<p class="ltx_p">In the dialog window, select the bitstream file. We&rsquo;ll start directly with the larger 2x2 system, you can find the bitstream in
<span class="ltx_ref ltx_path ltx_ref_self"><span class="ltx_text ltx_font_typewriter">$OPTISMOC/examples/system_2x2_cccc_nexys4ddr/system_2x2_cccc_nexys4ddr.bit</span></span>.</p>
</div>
</li>
<li id="I5.i7" class="ltx_item">
<div id="I5.i7.p1" class="ltx_para">
<p class="ltx_p">You can leave the other field &ldquo;Debug probes file&rdquo; empty.</p>
</div>
</li>
<li id="I5.i8" class="ltx_item">
<div id="I5.i8.p1" class="ltx_para">
<p class="ltx_p">Click on &ldquo;Program&rdquo; to flash the bitstream onto the FPGA.</p>
</div>
</li>
</ul>
</div>
<div id="S7.SS2.p3" class="ltx_para">
<p class="ltx_p">After a couple of seconds, your FPGA contains the SoC hardware and is ready to be used.</p>
</div>
</section>
<section id="S7.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.7.3 </span>Connecting</h3>

<div id="S7.SS3.p1" class="ltx_para">
<p class="ltx_p">In the previous tutorials, we have already seen the debug infrastructure and connected to it over TCP.
We now use the same tools to connect to our SoC, but this time we connect to the FPGA using UART.
Fortunately, you don&rsquo;t need to connect any additional cables; the USB cable that you just used to program the FPGA is also the serial connection.</p>
</div>
<div id="S7.SS3.p2" class="ltx_para">
<p class="ltx_p">First, check which serial port was assigned to the board.
Usually the easiest way is to do a</p>
<div id="LSTx34" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,ls%20/dev/ttyUSB*">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">ls<span class="ltx_text ltx_lst_space">&nbsp;</span>/dev/ttyUSB*</span>
                </td>
</tr>
</table>
</div>
</div>
<div id="S7.SS3.p3" class="ltx_para">
<p class="ltx_p">If you have only the Nexys 4 DDR board connected, you&rsquo;ll see only one device, e.g. <code class="ltx_verbatim ltx_font_typewriter">/dev/ttyUSB0</code>.
Make note of this device name, and replace it accordingly in all the following steps in this tutorial.</p>
</div>
<div id="S7.SS3.p4" class="ltx_para">
<p class="ltx_p">Just as before, we&rsquo;ll need more than one terminal window.
Open a first terminal and start <code class="ltx_verbatim ltx_font_typewriter">opensocdebugd</code> (remember to replace the device with your device name).</p>
<div id="LSTx35" class="ltx_listingblock ltx_lstlisting ltx_lst_language_sh ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,opensocdebugd%20uart%20device=/dev/ttyUSB1%20speed=12000000">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">opensocdebugd<span class="ltx_text ltx_lst_space">&nbsp;</span>uart<span class="ltx_text ltx_lst_space">&nbsp;</span>device=/dev/ttyUSB1<span class="ltx_text ltx_lst_space">&nbsp;</span>speed=1200000</span>
                </td>
</tr>
</table>
</div>
</div>
<div id="S7.SS3.p5" class="ltx_para">
<p class="ltx_p">The output you see should be almost identical to what you&rsquo;ve seen in Section&nbsp;<a href="#S5" title="3.5 Observing Software During Execution: The Debug System &#8227; Chapter&nbsp;3 Tutorials &#8227; OpTiMSoC User Guide" class="ltx_ref"><span class="ltx_text ltx_ref_tag">3.5</span></a>, with one change:
the system you&rsquo;re now using has just one CPU per compute tile, so only four cores in total.
As consequence, you see less CTM and STM modules.</p>
</div>
</section>
<section id="S7.SS4" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.7.4 </span>Running Software</h3>

<div id="S7.SS4.p1" class="ltx_para">
<p class="ltx_p">Now that you&rsquo;ve connected to the system, can you run software on it?
Yes, you already know how!
Open a new terminal window, and use <code class="ltx_verbatim ltx_font_typewriter">osd-cli</code> or the Python script to flash the memories with an ELF file and run the system.</p>
</div>
<div id="S7.SS4.p2" class="ltx_para">
<p class="ltx_p">When you run software, you&rsquo;ll notice two things: first, the output is the same as you&rsquo;ve already seen when running the system in simulation.
But: it&rsquo;s much faster. The FPGA runs at 50&nbsp;MHz, which is still quite slow compared to current desktop processors, but still much faster than the simulation.</p>
</div>
<div id="S7.SS4.p3" class="ltx_para">
<p class="ltx_p">This concludes our tutorial session, and hands over to you:
modify the software as you wish, program it again, analyze the simulations and explore your first multicore SoC.</p>
</div>
</section>
</section>
</section>
</div>
</div>
</div>

</div>


  <!-- footer -->
  <hr>
  <footer class="optimsoc-footer">
    <p>OpTiMSoC &copy; 2012-2020 OpTiMSoC Maintainers &middot; Imprint</p>
  </footer>

  <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</body>
</html>
