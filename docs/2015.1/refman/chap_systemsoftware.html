---
layout: default
title: OpTiMSoC Reference Manual
sectiontitle: Reference Manual
---
    <div class="col-md-3"><div class="optimsoc-doc-mainnav" data-spy="affix" data-offset-top="50">
<div style="padding-bottom:10px">
          version 2015.1

          (<a href="/docs/index.html#document-archive">other versions</a>)
        </div>
<ul class="nav">
<li><a href="chap_toolchain.html" title="Chapter&nbsp;1 Toolchain &#8227; OpTiMSoC Reference Manual">Toolchain</a></li>
<li class="active">
<div class="active">System Software</div>
<div id="optimsoc-doc-subnav-nav" class="optimsoc-doc-subnav hidden-print" role="complementary"><ul class="nav">
<li class=""><a href="#S1" title="2.1 System Libraries &#8227; Chapter&nbsp;2 System Software &#8227; OpTiMSoC Reference Manual">System Libraries</a></li>
<li class=""><a href="#S2" title="2.2 Building and Installing the System Libraries &#8227; Chapter&nbsp;2 System Software &#8227; OpTiMSoC Reference Manual">Building and Installing the System Libraries</a></li>
<li class=""><a href="#S3" title="2.3 Building Software &#8227; Chapter&nbsp;2 System Software &#8227; OpTiMSoC Reference Manual">Building Software</a></li>
</ul></div>
</li>
<li><a href="chap_system-configuration.html" title="Chapter&nbsp;3 System Configuration &#8227; OpTiMSoC Reference Manual">System Configuration</a></li>
<li><a href="Ch4.html" title="Chapter&nbsp;4 Trace Debugging &#8227; OpTiMSoC Reference Manual">Trace Debugging</a></li>
</ul>
</div></div><div class="col-md-9 optimsoc-doc-body">
<div class="ltx_page_main">
<div class="ltx_page_content">
<section class="ltx_chapter">
<h1 class="ltx_title ltx_title_chapter">
<span class="ltx_tag ltx_tag_chapter">Chapter&nbsp;2 </span>System Software</h1>
<div class="ltx_date ltx_role_creation"></div>

<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2.1 </span>System Libraries</h2>

<div id="S1.p1" class="ltx_para">
<p class="ltx_p">The system libraries are build in a unified environment, that means
all libraries are build together and managed by one build system. When
checking out an empty directory, the clean directory structure at base
level (that is <code class="ltx_verbatim ltx_font_typewriter">src/sw/system/dm</code>) looks like:</p>
</div>
<div id="S1.p2" class="ltx_para">
<div id="LSTx5" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,apps/%0Aautogen.sh%0Abootrom/%0Aconfigure.ac%0Adoc/%0Am4/%0AMakefile.am%0Asrc/">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">apps/</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">autogen.sh</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">bootrom/</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">configure.ac</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">doc/</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">m4/</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">Makefile.am</span>
              </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                <span class="ltx_text ltx_lst_line ltx_font_typewriter">src/</span>
              </td>
</tr>
</table>
</div>
</div>
<div id="S1.p3" class="ltx_para">
<p class="ltx_p">The grey folders and files are part of the (autotools) build
structure. The libraries can be found in <code class="ltx_verbatim ltx_font_typewriter">src</code> and will be
discussed below. The <code class="ltx_verbatim ltx_font_typewriter">apps</code> folder contains (example)
applications that are shipped with the distribution. They will
actually not be build in place but together with a system
configuration in your system&rsquo;s environment.</p>
</div>
<div id="S1.p4" class="ltx_para">
<p class="ltx_p">The <code class="ltx_verbatim ltx_font_typewriter">doc</code> folder contains the Doxygen configuration to build the
API documentation (pdf and html) you can also find online. Finally,
<code class="ltx_verbatim ltx_font_typewriter">bootrom</code> contains the bootcode and the necessary programs to
translate the binary to verilog code to include in the hardware.</p>
</div>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2.2 </span>Building and Installing the System Libraries</h2>

<div id="S2.p1" class="ltx_para">
<p class="ltx_p">The system software build system is based on autotools (autoconf,
automake) and libtool. Make sure you have the necessary tools
installed.</p>
</div>
<div id="S2.p2" class="ltx_para">
<p class="ltx_p">In the current system state we encourage you to build and install the
system libraries in place. Most of the descriptions and tutorial parts
relate to that scheme. When doing so (as described below) you will
install libraries, headers and scripts needed for building software in
the system software folder in <code class="ltx_verbatim ltx_font_typewriter">lib/</code>, <code class="ltx_verbatim ltx_font_typewriter">include/</code> and
<code class="ltx_verbatim ltx_font_typewriter">share/</code>.</p>
</div>
<section id="S2.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2.1 </span>Generate the <span class="ltx_text ltx_font_typewriter">configure</span> script</h3>

<div id="S2.SS1.p1" class="ltx_para">
<p class="ltx_p">Although the autotools are complex, generating the <code class="ltx_verbatim ltx_font_typewriter">configure</code>
script is easily done running the <code class="ltx_verbatim ltx_font_typewriter">autogen.sh</code> script. Just run
the command in place:</p>
</div>
<div id="S2.SS1.p2" class="ltx_para">
<div id="LSTx6" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,./autogen.sh">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">./autogen.sh</span>
                </td>
</tr>
</table>
</div>
</div>
<div id="S2.SS1.p3" class="ltx_para">
<p class="ltx_p">Afterwards, the <code class="ltx_verbatim ltx_font_typewriter">configure</code> script will be present. As mentioned
above, you should not run it in place but create a separate building
directory:</p>
</div>
<div id="S2.SS1.p4" class="ltx_para">
<div id="LSTx7" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,mkdir%20build%0Acd%20build">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">mkdir<span class="ltx_text ltx_lst_space">&nbsp;</span>build</span>
                </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">cd<span class="ltx_text ltx_lst_space">&nbsp;</span>build</span>
                </td>
</tr>
</table>
</div>
</div>
<div id="S2.SS1.p5" class="ltx_para">
<p class="ltx_p">The <code class="ltx_verbatim ltx_font_typewriter">autogen.sh</code> script already gave you the commonly used
configure command line:</p>
</div>
<div id="S2.SS1.p6" class="ltx_para">
<div id="LSTx8" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,../configure%20CFLAGS='-g%20-O0'%20--prefix=%60pwd%60/..%20--host=or32%20%5C%0A%20%20CC=or32-elf-gcc">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">../configure<span class="ltx_text ltx_lst_space">&nbsp;</span>CFLAGS='-g<span class="ltx_text ltx_lst_space">&nbsp;</span>-O0'<span class="ltx_text ltx_lst_space">&nbsp;</span>--prefix=`pwd`/..<span class="ltx_text ltx_lst_space">&nbsp;</span>--host=or32<span class="ltx_text ltx_lst_space">&nbsp;</span>\</span>
                </td>
</tr>
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter"><span class="ltx_text ltx_lst_space">&nbsp;&nbsp;</span>CC=or32-elf-gcc</span>
                </td>
</tr>
</table>
</div>
</div>
<div id="S2.SS1.p7" class="ltx_para">
<p class="ltx_p">This assumes you have an environment variable <code class="ltx_verbatim ltx_font_typewriter">OPTIMSOC_NEWLIB</code>
set. Alternatively you can set the path using
<code class="ltx_verbatim ltx_font_typewriter">--with-optimsoc-newlib</code>. You can also change the compiler if
necessary. The Makefile templates for libraries are also built based
on the <code class="ltx_verbatim ltx_font_typewriter">CC</code> setting. As they also contain calls to <code class="ltx_verbatim ltx_font_typewriter">objdump</code>
and <code class="ltx_verbatim ltx_font_typewriter">objcopy</code>, the script tries to replace gcc in the <code class="ltx_verbatim ltx_font_typewriter">CC</code>
variable with those values. In case the programs are called different
you can set <code class="ltx_verbatim ltx_font_typewriter">OR32OBJDUMP</code> and <code class="ltx_verbatim ltx_font_typewriter">OR32OBJCOPY</code> environment
variables in the configure run accordingly.</p>
</div>
</section>
<section id="S2.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2.2 </span>Build and Install</h3>

<div id="S2.SS2.p1" class="ltx_para">
<p class="ltx_p">Afterwards you are ready to build your software</p>
</div>
<div id="S2.SS2.p2" class="ltx_para">
<div id="LSTx9" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,make">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">make</span>
                </td>
</tr>
</table>
</div>
</div>
<div id="S2.SS2.p3" class="ltx_para">
<p class="ltx_p">and then install it</p>
</div>
<div id="S2.SS2.p4" class="ltx_para">
<div id="LSTx10" class="ltx_listingblock ltx_lstlisting ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain,make%20install">&#11015;</a></div>
<table class="ltx_tabular">
<tr class="ltx_tr">
<td class="ltx_td">
                  <span class="ltx_text ltx_lst_line ltx_font_typewriter">make<span class="ltx_text ltx_lst_space">&nbsp;</span>install</span>
                </td>
</tr>
</table>
</div>
</div>
<div id="S2.SS2.p5" class="ltx_para">
<p class="ltx_p">Afterwards you will find the libraries in <code class="ltx_verbatim ltx_font_typewriter">$(prefix)/lib</code> (in
most cases directly in the system software base folder). Furthermore
the headers plus extra build files are installed.</p>
</div>
</section>
<section id="S2.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2.3 </span>Develop System Libraries</h3>

<div id="S2.SS3.p1" class="ltx_para">
<p class="ltx_p">Development</p>
</div>
</section>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2.3 </span>Building Software</h2>

</section>
</section>
</div>
</div>
</div>
